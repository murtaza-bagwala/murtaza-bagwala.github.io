{"expireTime":9007200894070161000,"key":"transformer-remark-markdown-ast-7faebc93ee4bcc4dd0cee2b3e742ec0a-gatsby-remark-relative-imagesgatsby-remark-katexgatsby-remark-imagesgatsby-remark-responsive-iframegatsby-remark-autolink-headersgatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypantsgatsby-remark-external-links-","val":{"type":"root","children":[{"type":"paragraph","children":[{"type":"text","value":"We often hear ","position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":15,"offset":15},"indent":[]}},{"type":"strong","children":[{"type":"emphasis","children":[{"type":"text","value":"Cache invalidation is a hard problem in computer science and could cause bugs","position":{"start":{"line":2,"column":18,"offset":18},"end":{"line":2,"column":95,"offset":95},"indent":[]}}],"position":{"start":{"line":2,"column":17,"offset":17},"end":{"line":2,"column":96,"offset":96},"indent":[]}}],"position":{"start":{"line":2,"column":15,"offset":15},"end":{"line":2,"column":98,"offset":98},"indent":[]}},{"type":"text","value":"\nbut sometimes, caching something that should not be cached is a potential source of bugs\nand security vulnerabilities.\nRails has a built-in mechanism for ","position":{"start":{"line":2,"column":98,"offset":98},"end":{"line":5,"column":36,"offset":253},"indent":[1,1,1]}},{"type":"link","title":null,"url":"https://guides.rubyonrails.org/caching_with_rails.html#fragment-caching","children":[{"type":"text","value":"Fragment Caching","position":{"start":{"line":5,"column":37,"offset":254},"end":{"line":5,"column":53,"offset":270},"indent":[]}}],"position":{"start":{"line":5,"column":36,"offset":253},"end":{"line":5,"column":127,"offset":344},"indent":[]},"data":{"hProperties":{"target":"_blank","rel":"nofollow noopener noreferrer"}}},{"type":"text","value":",\nwhich stores part of the rendered view as a fragment. \nFor subsequent requests, the pre-saved fragment is used instead of rendering it again.","position":{"start":{"line":5,"column":127,"offset":344},"end":{"line":7,"column":87,"offset":487},"indent":[1,1]}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":7,"column":87,"offset":487},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"But this could cause some serious bugs\nfor example, we could have an s3 URL helper which generates a unique presigned URL \nfor each of the product \nor one could write a form helper that outputs a request-specific auth token, \nin such cases, it is better to avoid Fragment Caching.","position":{"start":{"line":9,"column":1,"offset":489},"end":{"line":13,"column":55,"offset":769},"indent":[1,1,1,1]}}],"position":{"start":{"line":9,"column":1,"offset":489},"end":{"line":13,"column":55,"offset":769},"indent":[1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#before","title":null,"children":[],"data":{"hProperties":{"aria-label":"before permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Before","position":{"start":{"line":15,"column":5,"offset":775},"end":{"line":15,"column":11,"offset":781},"indent":[]}}],"position":{"start":{"line":15,"column":1,"offset":771},"end":{"line":15,"column":11,"offset":781},"indent":[]},"data":{"id":"before","htmlAttributes":{"id":"before"},"hProperties":{"id":"before","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"Using the ","position":{"start":{"line":17,"column":1,"offset":783},"end":{"line":17,"column":11,"offset":793},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">cache</code>","position":{"start":{"line":17,"column":11,"offset":793},"end":{"line":17,"column":18,"offset":800},"indent":[]}},{"type":"text","value":" helper we can implement fragment caching.","position":{"start":{"line":17,"column":18,"offset":800},"end":{"line":17,"column":60,"offset":842},"indent":[]}}],"position":{"start":{"line":17,"column":1,"offset":783},"end":{"line":17,"column":60,"offset":842},"indent":[]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"views/products/index.html.erb","position":{"start":{"line":19,"column":3,"offset":846},"end":{"line":19,"column":32,"offset":875},"indent":[]}}],"position":{"start":{"line":19,"column":1,"offset":844},"end":{"line":19,"column":34,"offset":877},"indent":[]}}],"position":{"start":{"line":19,"column":1,"offset":844},"end":{"line":19,"column":34,"offset":877},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"{% highlight ruby %}","position":{"start":{"line":21,"column":1,"offset":879},"end":{"line":21,"column":21,"offset":899},"indent":[]}}],"position":{"start":{"line":21,"column":1,"offset":879},"end":{"line":21,"column":21,"offset":899},"indent":[]}},{"type":"html","value":"  <table>\n    <thead>\n        <tr>\n        <th>Title</th>\n        <th>Description</th>\n        <th>Image</th>\n        </tr>\n    </thead>","position":{"start":{"line":22,"column":1,"offset":900},"end":{"line":29,"column":13,"offset":1036},"indent":[1,1,1,1,1,1,1]}},{"type":"html","lang":null,"meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;tbody&gt;\n    &lt;% @products.each do |product| %&gt;\n      &lt;% cache(product) do %&gt;\n          &lt;%= render product %&gt;\n      &lt;% end %&gt;\n    &lt;% end %&gt;\n&lt;/tbody&gt;</code></pre></div>","position":{"start":{"line":31,"column":1,"offset":1038},"end":{"line":37,"column":13,"offset":1212},"indent":[1,1,1,1,1,1]}},{"type":"html","value":"  </table>\n{% endhighlight %}  ","position":{"start":{"line":38,"column":1,"offset":1213},"end":{"line":39,"column":21,"offset":1244},"indent":[1]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"views/products/_product.html.erb","position":{"start":{"line":41,"column":3,"offset":1248},"end":{"line":41,"column":35,"offset":1280},"indent":[]}}],"position":{"start":{"line":41,"column":1,"offset":1246},"end":{"line":41,"column":37,"offset":1282},"indent":[]}}],"position":{"start":{"line":41,"column":1,"offset":1246},"end":{"line":41,"column":37,"offset":1282},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"{% highlight ruby %}","position":{"start":{"line":43,"column":1,"offset":1284},"end":{"line":43,"column":21,"offset":1304},"indent":[]}}],"position":{"start":{"line":43,"column":1,"offset":1284},"end":{"line":43,"column":21,"offset":1304},"indent":[]}},{"type":"html","value":"  <tr>\n    <td><%= product.title %></td>\n    <td><%= product.description %></td>\n    <td><%= image_tag(generate_presigned_url(product.image_url)) %></td>\n  </tr>\n{% endhighlight %}","position":{"start":{"line":44,"column":1,"offset":1305},"end":{"line":49,"column":19,"offset":1485},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"But, here is a bug because, \nwe get a cached version of the product each time we are rendering the products \nthough, we are generating the unique presigned URL each time. \nTo resolve the above issue,\nwe need to include ","position":{"start":{"line":51,"column":1,"offset":1487},"end":{"line":55,"column":20,"offset":1706},"indent":[1,1,1,1]}},{"type":"html","value":"<code class=\"language-text\">cacheable</code>","position":{"start":{"line":55,"column":20,"offset":1706},"end":{"line":55,"column":31,"offset":1717},"indent":[]}},{"type":"text","value":" in the Product partial \nso that if someone tries to cache the product partial it would throw an ","position":{"start":{"line":55,"column":31,"offset":1717},"end":{"line":56,"column":73,"offset":1814},"indent":[1]}},{"type":"html","value":"<code class=\"language-text\">ActionView::Template::Error</code>","position":{"start":{"line":56,"column":73,"offset":1814},"end":{"line":56,"column":102,"offset":1843},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":56,"column":102,"offset":1843},"end":{"line":56,"column":103,"offset":1844},"indent":[]}}],"position":{"start":{"line":51,"column":1,"offset":1487},"end":{"line":56,"column":103,"offset":1844},"indent":[1,1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#after","title":null,"children":[],"data":{"hProperties":{"aria-label":"after permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"After","position":{"start":{"line":58,"column":5,"offset":1850},"end":{"line":58,"column":10,"offset":1855},"indent":[]}}],"position":{"start":{"line":58,"column":1,"offset":1846},"end":{"line":58,"column":10,"offset":1855},"indent":[]},"data":{"id":"after","htmlAttributes":{"id":"after"},"hProperties":{"id":"after","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"{% highlight ruby %}","position":{"start":{"line":60,"column":1,"offset":1857},"end":{"line":60,"column":21,"offset":1877},"indent":[]}}],"position":{"start":{"line":60,"column":1,"offset":1857},"end":{"line":60,"column":21,"offset":1877},"indent":[]}},{"type":"html","value":"  <tr>\n    <%= uncacheable! %>\n    <td><%= product.title %></td>\n    <td><%= product.description %></td>\n    <td><%= image_tag(generate_presigned_url(product.image_url)) %></td>\n  </tr>\n{% endhighlight %}","position":{"start":{"line":61,"column":1,"offset":1878},"end":{"line":67,"column":19,"offset":2082},"indent":[1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"which would result in","position":{"start":{"line":69,"column":1,"offset":2084},"end":{"line":69,"column":22,"offset":2105},"indent":[]}}],"position":{"start":{"line":69,"column":1,"offset":2084},"end":{"line":69,"column":22,"offset":2105},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"{% highlight ruby %}","position":{"start":{"line":71,"column":1,"offset":2107},"end":{"line":71,"column":21,"offset":2127},"indent":[]}}],"position":{"start":{"line":71,"column":1,"offset":2107},"end":{"line":71,"column":21,"offset":2127},"indent":[]}},{"type":"html","lang":null,"meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  ActionView::Template::Error (can&#39;t be fragment cached):\n    1: &lt;tr&gt;\n    2:     &lt;%= uncacheable! %&gt;\n    3:   &lt;td&gt;&lt;%= product.title %&gt;&lt;/td&gt;\n    4:   &lt;td&gt;&lt;%= product.description %&gt;&lt;/td&gt;\n    5:   &lt;td&gt;&lt;%= image_tag(generate_presigned_url(product.image_url)) %&gt;&lt;/td&gt;\n  \n  app/views/products/_product.html.erb:2</code></pre></div>","position":{"start":{"line":72,"column":1,"offset":2128},"end":{"line":81,"column":5,"offset":2443},"indent":[1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"{% endhighlight %}","position":{"start":{"line":82,"column":1,"offset":2444},"end":{"line":82,"column":19,"offset":2462},"indent":[]}}],"position":{"start":{"line":82,"column":1,"offset":2444},"end":{"line":82,"column":19,"offset":2462},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"we can also use the ","position":{"start":{"line":85,"column":1,"offset":2465},"end":{"line":85,"column":21,"offset":2485},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">caching?</code>","position":{"start":{"line":85,"column":21,"offset":2485},"end":{"line":85,"column":31,"offset":2495},"indent":[]}},{"type":"text","value":" helper to check whether the current code path is being cached \nor to enforce caching.","position":{"start":{"line":85,"column":31,"offset":2495},"end":{"line":86,"column":23,"offset":2581},"indent":[1]}}],"position":{"start":{"line":85,"column":1,"offset":2465},"end":{"line":86,"column":23,"offset":2581},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"{% highlight ruby %}","position":{"start":{"line":88,"column":1,"offset":2583},"end":{"line":88,"column":21,"offset":2603},"indent":[]}}],"position":{"start":{"line":88,"column":1,"offset":2583},"end":{"line":88,"column":21,"offset":2603},"indent":[]}},{"type":"html","value":"  <tr>\n    <%= raise Exception.new \"This partial needs to be cached\" unless caching? %>\n    <td><%= product.title %></td>\n    <td><%= product.description %></td>\n  </tr>\n{% endhighlight %}","position":{"start":{"line":89,"column":1,"offset":2604},"end":{"line":94,"column":19,"offset":2792},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"For more discussion related to this change,\nplease refer to this\n","position":{"start":{"line":96,"column":1,"offset":2794},"end":{"line":98,"column":1,"offset":2859},"indent":[1,1]}},{"type":"link","title":null,"url":"https://github.com/rails/rails/pull/42365","children":[{"type":"text","value":"PR","position":{"start":{"line":98,"column":2,"offset":2860},"end":{"line":98,"column":4,"offset":2862},"indent":[]}}],"position":{"start":{"line":98,"column":1,"offset":2859},"end":{"line":98,"column":48,"offset":2906},"indent":[]},"data":{"hProperties":{"target":"_blank","rel":"nofollow noopener noreferrer"}}},{"type":"text","value":".","position":{"start":{"line":98,"column":48,"offset":2906},"end":{"line":98,"column":49,"offset":2907},"indent":[]}}],"position":{"start":{"line":96,"column":1,"offset":2794},"end":{"line":98,"column":49,"offset":2907},"indent":[1,1]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":99,"column":1,"offset":2908}}}}